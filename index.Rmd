---
title: "Considering the Ripple Effects of Climate Change"
author: "Bella Han, Lillian Kim, Mythili Subbanna"
date: "November 15, 2020"
#css: custom.css
output: 
  rmdformats::readthedown:
    thumbnails: false
    highlight: NULL
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.align="center")

library(tidyverse)
library(leaflet)
library(maps)
library(mdsr)
library(readr)
library(dplyr)
library(janitor)
library(countrycode)
library(tabulizer)
library(plotly)
library(ggplot2)
library(gganimate)
library(gifski)
library(shiny)
library(shinythemes)
library(shiny)

path_mythili <- "C:/Users/seshu/Documents/RStudio/projects/git/Blog-HealthAndJusticeLeague/data"
path_bella <- "C:/Users/Bella/Desktop/git/Blog-HealthAndJusticeLeague/data"
path_lillian <- "C:/Users/Yesuel Kim/Documents/Git/Blog-HealthAndJusticeLeague/data"

######### fixme: change this before you run the code! ###########

my_path <- path_bella


```

### Extra Info for insertion of elements into Blog - don't delete until the end!

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For example, you can include **Bold** and _Italic_ and `Code` text.  For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

You should test out updating your GitHub Pages website:

- clone your group's blog project repo in RStudio
- update "Your Project Title Here" to a new title in the YAML header
- knit `index.Rmd` 
- commit and push BOTH the `index.Rmd` and the `index.html` files
- go to https://stat231-f20.github.io/Blog-HealthAndJusticeLeague to see the published test document (this is publicly available!)


## Including links and images

You can include [Links](https://www.datadreaming.org/post/r-markdown-theme-gallery/) and images ![team logo](https://raw.githubusercontent.com/stat231-f20/Blog-HealthAndJusticeLeague/main/images/ph_sj1-7.png)

## Beyond Global Warming

Social justice, by definition, considers justice in terms of rights, opportunities, and privileges within a society, on a regional, national, or international level. The idea behind social justice is that everyone has an innate value as human beings, and no person’s value is more or less than anyone else’s. These rights and opportunities include seemingly basic necessities of a person today, such as access to healthcare, food, and safe spaces to live.

While there are a variety of different social justice issues worldwide, some of them are more relevant and prevalent depending on the region you're talking about. As these issues are often broad and diverse, we would like to focus on a single, seemingly less prevalent, factor that may have been affecting people's quality of life on a global scale to varying degrees: **environmental change**. 

In 2019, the United Nations Foundation listed climate change as the top global issue to watch, as global emissions of greenhouse gases have been consistently rising since the early 2000s. This rise has partially contributed to the global temperature increase over time (1880-2020) that we have seen over time (Figure 1).

<iframe height="600" width="100%" frameborder="no" title="Increase in Global Temperature" src="https://lillianykim.shinyapps.io/globaltemperature/"> </iframe>


Climate change, and this temperature increase, can affect the future prevalence and intensity of various climate disasters. These effects include a higher risk of droughts and possibly floods (due to less frequent, but more intense precipitation). Furthermore, the temperature increase worldwide can bring the temperatures at the north and south poles, closter to that of the equator. The temperature increase will make the poles hotter and more humid, which in fact could reduce the number of storms. But this sounds like a good thing, right? Unfortunately, as land surface temperatures, humidity, there is more water vapor present in the atmosphere, so the intensity of the storms, as well as the domain of occurrence for certain tropical storms, could increase. Furthermore, these rising land and sea surface temperatures are causing glacial melting, which increases the sea levels and thus can increases the extent of coastal flooding (*Climate Insights 2020: Natural Disasters*, *The Impact of Climate Change on Natural Disasters*).

Given this information, we wondered whether climate change could be considered as one of the aforementioned social justice issues, and whether it is disproportionately related to quality of life in different parts of the globe. However, considering the effects of climate change as a whole on society is a hefty task. Instead, we investigated the ripple effects of air quality and the prevalence of climate disasters, on a community's public health. Public health, in relation to these environmental events, was looked at through three different lenses, as described in the questions below:

References Used:
https://earthobservatory.nasa.gov/features/RisingCost/rising_cost5.php
https://www.rff.org/publications/reports/climateinsights2020-natural-disasters/

### Research Questions

1. Are the effects of climate change (specifically air pollution) evident in epidemiological prevalence data or mortality data?

2. How do climate change ripple effects (measured via infant and maternal mortality) show differently in developing (i.e. more agriculture-based) versus developed countries?

3. How has the impact of natural disasters changed over time? How many people have been affected by these climate disasters?


# Are environmental issues evident in epidemiological prevalence data or mortality data? (BH)

We are often poised to think of air pollution as one of the most apparent environmental issues around the world today, as we hear about the emission of pollutants and chemicals from various technology and industry.  Therefore, we chose to investigate air quality and whether its impact is evident in global health. 

Our measure of air quality is exposure to ambient particulate matter (PM2.5), a type of air pollutants. In particular, our variable indicates the **mean population exposure to outdoor PM2.5**, calculated as the mean annual outdoor PM2.5 concentration weighted by population living in the relevant area, that is, the concentration level, expressed in ug/m^3^ to which a typical resident is exposed throughout a year. 

We then chose to look at morbidity as our measure of people’s health affected by air quality. Specifically, this variable measures the **disability-adjusted life years (DALY)**, which are calculated as the number of years lost due to exposure to environmental-related risks, expressed in absolute value, per 1000 inhabitants. DALYs are defined as the sum of years of potential life lost due to premature mortality and the years of productive life lost. Both the exposure to PM2.5 and DALY data were collected and released by the OECD; the details of the methods can be found at the end of the report. 

## Investigation on Air Quality through Leaflets

To visualize our data, we chose to create a series of choropleths that display the level of exposure to particulate matter and the number of years lost due to this exposure in each country around the world. The following two choropleths show PM2.5 exposure in 1990 and 2017, respectively. We chose to create leaflets to allow for interactivity of hovering over or selecting a particular country. 

To help with the understanding of this measure, we will provide a few examples in context. When a user selects the country Brazil by clicking on it on the leaflet showing the data for 1990, a value of 15.402 µg/m^3^ will be displayed as the PM2.5 measure. This means that the mean annual outdoor PM2.5 concentration is 15.402 µg/m^3^, and this value is also weighted, or standardized, by population. As another example, Saudi Arabia displays a value of 92.368 µg/m^3^ on the leaflet showing data for 2017. Based on the PM2.5 guideline provided by the World Health Organization, Brazil in 1990 is considered to be in a moderate range of PM2.5, while Saudi Arabia is in a highly dangerous range. Despite such great differences in the PM2.5 level in different countries, these two choropleths show that the air quality in general has improved over the years from 1990 to 2017. This change is most noticeable in many countries in the Eastern Europe, Latin America, and Southern Africa, while there are several countries undergoing a similar change in parts of Asia. 

```{r, echo = FALSE, message = FALSE, warning = FALSE, include = FALSE}
data_air <- read_csv(paste0(my_path, "/wrangled_air_final.csv."))
data_DALY <- read_csv(paste0(my_path, "/wrangled_DALY_final.csv."))
data_joined <- read_csv(paste0(my_path, "/joined_air_DALY_final.csv"))
```

```{r, message = FALSE, include = FALSE, warning = FALSE}
#leaflet for PM2.5
#world_leaflet$names
world_leaflet <- map("world", unique(data_air$Country), fill = TRUE, plot = FALSE)
world_leaflet$country <- vapply(strsplit(world_leaflet$names, ":"), function(x) x[1],
                                FUN.VALUE = "a")
world_leaflet$Y1990 <- data_air$Y1990[match(world_leaflet$country, data_air$Country)]
world_leaflet$Y2017 <- data_air$Y2017[match(world_leaflet$country, data_air$Country)]
world_leaflet$change <- data_air$change[match(world_leaflet$country, data_air$Country)]

bins <- c(0, 10, 15, 25, 35, Inf)
binschange <- c(-Inf, -5, 0, 5, Inf)
pal1990 <- colorBin("YlOrRd", domain = world_leaflet$Y1990, bins = bins)
pal2017 <- colorBin("YlOrRd", domain = world_leaflet$Y2017, bins = bins)
palchange <- colorBin("PiYG", domain = world_leaflet$change, bins = binschange)

#for 1990
PM25_1990_leaflet <- leaflet(data = world_leaflet)%>%
  addTiles()%>%
  setView(0, 0, zoom = 1.5)%>%
  addPolygons(fillColor = ~pal1990(Y1990),
              weight = 1,
              opacity = 1,
              color = "white",
              dashArray = "3",
              fillOpacity = 0.7,
              highlight = highlightOptions(weight = 2,
                                           color = "#666",
                                           dashArray = "",
                                           fillOpacity = 0.7,
                                            bringToFront = TRUE),
              label = sprintf("<strong>%s</strong><br/>%g µg / m<sup>3</sup>",
                              world_leaflet$country, world_leaflet$Y1990)%>% 
                lapply(htmltools::HTML),
              labelOptions = labelOptions(style = list("font-weight" = "normal", padding = "3px 8px"),
                                          textsize = "12px",
                                          direction = "auto"),
              popup = paste0("Country: ", world_leaflet$country, "<br>",
                             "PM2.5 Value: ", round(world_leaflet$Y1990, 3), 
                             " µg / m<sup>3</sup><br>"))%>%
  addLegend(pal = pal1990, values = ~Y1990, 
            opacity = 0.7, 
            title = "PM 2.5 Measure in 1990",
            position = "bottomright")


#for 2017
PM25_2017_leaflet <- leaflet(data = world_leaflet)%>%
  addTiles()%>%
  setView(0, 0, zoom = 1.5)%>%
  addPolygons(fillColor = ~pal2017(Y2017),
              weight = 1,
              opacity = 1,
              color = "white",
              dashArray = "3",
              fillOpacity = 0.7,
              highlight = highlightOptions(weight = 2,
                                           color = "#666",
                                           dashArray = "",
                                           fillOpacity = 0.7,
                                            bringToFront = TRUE),
              label = sprintf("<strong>%s</strong><br/>%g µg / m<sup>3</sup>",
                              world_leaflet$country, world_leaflet$Y2017)%>% 
                lapply(htmltools::HTML),
              labelOptions = labelOptions(style = list("font-weight" = "normal", padding = "3px 8px"),
                                          textsize = "12px",
                                          direction = "auto"),
              popup = paste0("Country: ", world_leaflet$country, "<br>",
                             "PM2.5 Value: ", round(world_leaflet$Y2017, 3), 
                             " µg / m<sup>3</sup><br>"))%>%
  addLegend(pal = pal2017, values = ~Y2017, 
            opacity = 0.7, 
            title = "PM 2.5 Measure in 2017",
            position = "bottomright")

PM25_change_leaflet <- leaflet(data = world_leaflet)%>%
  addTiles()%>%
  setView(0, 0, zoom = 1.5)%>%
  addPolygons(fillColor = ~palchange(change),
              weight = 1,
              opacity = 1,
              color = "white",
              dashArray = "3",
              fillOpacity = 0.7,
              highlight = highlightOptions(weight = 2,
                                           color = "#666",
                                           dashArray = "",
                                           fillOpacity = 0.7,
                                            bringToFront = TRUE),
              label = sprintf("<strong>%s</strong><br/>%g µg / m<sup>3</sup>",
                              world_leaflet$country, world_leaflet$change)%>% 
                lapply(htmltools::HTML),
              labelOptions = labelOptions(style = list("font-weight" = "normal", padding = "3px 8px"),
                                          textsize = "12px",
                                          direction = "auto"),
              popup = paste0("Country: ", world_leaflet$country, "<br>",
                             "PM2.5 Value: ", round(world_leaflet$change, 3), 
                             " µg / m<sup>3</sup><br>"))%>%
  addLegend(pal = palchange, values = ~change, 
            opacity = 0.7, 
            title = "Change in PM 2.5 Meausre from 1990 to 2017",
            position = "bottomright")
```

```{r, echo = FALSE}
#PM2.5 leaflets
PM25_1990_leaflet
PM25_2017_leaflet
```

These leaflets are effectively mapping the PM2.5 level on a global scale and letting us compare the PM2.5 level between multiple countries. Though we can see some changes undergone by some countries, this change is not dramatically apparent at first sight. Therefore, we created an additional leaflet that shows the change in PM2.5 level from 1990 to 2017. The value indicates the change from 1990 to 2017 (i.e. value_1990 - value_2017), so a positive value indicates a decrease in PM2.5 level, while a negative value indicates an increase. For example, India experienced an increase in PM2.5 level of 8.558 µg/m^3^. As we expect, now more clearly, we see a positive change in air quality in general around the world. 

```{r, echo = FALSE}
PM25_change_leaflet
```

## Investigation on Mortality (DALY) through Leaflets

Similar steps were taken for the next set of choropleths focusing on the disability-adjusted life years in 1990 and 2017 around the world. Just to interpret a few observations in context, we see that people in Brazil in 1990 lost 5.77 years of potential life due to exposure to ambient PM2.5 per 1000 inhabitants, and those in Russia in 2017 lost 15.681 years. Comparing these two choropleths, we see in general a decrease in the DALY score around the world, and this trend is most apparent in countries in Eastern Europe and Africa.

```{r, include = FALSE, warning = FALSE}
#leaflet for pdeaths
world_leaflet_DALY <- map("world", unique(data_DALY$country), 
                            fill = TRUE, plot = FALSE)
world_leaflet_DALY$country <- vapply(strsplit(world_leaflet_DALY$names, ":"),
                                       function(x) x[1],
                                FUN.VALUE = "a")
world_leaflet_DALY$Y1990 <- data_DALY$Y1990[match(world_leaflet_DALY$country, data_DALY$country)]
world_leaflet_DALY$Y2017 <- data_DALY$Y2017[match(world_leaflet_DALY$country, data_DALY$country)]
world_leaflet_DALY$change <- data_DALY$change[match(world_leaflet_DALY$country, data_DALY$country)]

binschange2 <- c(-Inf, -5, 0, 5, Inf)
bins2 <- c(0, 5, 10, 15, 20, Inf)
pal1990_2 <- colorBin("YlGnBu", domain = world_leaflet_DALY$Y1990, bins = bins2)
pal2017_2 <- colorBin("YlGnBu", domain = world_leaflet_DALY$Y2017, bins = bins2)
palchange2 <- colorBin("PiYG", domain = world_leaflet_DALY$change, bins = binschange2)

#for 1990
DALY_1990_leaflet <- leaflet(data = world_leaflet_DALY)%>%
  addTiles()%>%
  setView(0, 0, zoom = 1.5)%>%
  addPolygons(fillColor = ~pal1990_2(Y1990),
              weight = 1,
              opacity = 1,
              color = "white",
              dashArray = "3",
              fillOpacity = 0.7,
              highlight = highlightOptions(weight = 2,
                                           color = "#666",
                                           dashArray = "",
                                           fillOpacity = 0.7,
                                            bringToFront = TRUE),
              label = sprintf("<strong>%s</strong><br/>%g years",
                              world_leaflet_DALY$country, world_leaflet_DALY$Y1990)%>% 
                lapply(htmltools::HTML),
              labelOptions = labelOptions(style = list("font-weight" = "normal",
                                                       padding = "3px 8px"),
                                          textsize = "12px",
                                          direction = "auto"),
              popup = paste0("Country: ", world_leaflet_DALY$country, "<br>",
                             "DALY",
                             round(world_leaflet_DALY$Y1990, 2), 
                             " per 1k <br>"))%>%
  addLegend(pal = pal1990_2, values = ~Y1990, 
            opacity = 0.7, 
            title = "DALY in 1990",
            position = "bottomright")

#for 2017
DALY_2017_leaflet <- leaflet(data = world_leaflet_DALY)%>%
  addTiles()%>%
  setView(0, 0, zoom = 1.5)%>%
  addPolygons(fillColor = ~pal2017_2(Y2017),
              weight = 1,
              opacity = 1,
              color = "white",
              dashArray = "3",
              fillOpacity = 0.7,
              highlight = highlightOptions(weight = 2,
                                           color = "#666",
                                           dashArray = "",
                                           fillOpacity = 0.7,
                                            bringToFront = TRUE),
              label = sprintf("<strong>%s</strong><br/>%g units",
                              world_leaflet_DALY$country, world_leaflet_DALY$Y2017)%>% 
                lapply(htmltools::HTML),
              labelOptions = labelOptions(style = list("font-weight" = "normal",
                                                       padding = "3px 8px"),
                                          textsize = "12px",
                                          direction = "auto"),
              popup = paste0("Country: ", world_leaflet_DALY$country, "<br>",
                             "DALY Score: ",
                             round(world_leaflet_DALY$Y2017, 3), 
                             " per 1K <br>"))%>%
  addLegend(pal = pal2017_2, values = ~Y2017, 
            opacity = 0.7, 
            title = "DALY scores in 2017",
            position = "bottomright")

#CHANGE from 1990 to 2017
DALY_change_leaflet <- leaflet(data = world_leaflet_DALY)%>%
  addTiles()%>%
  setView(0, 0, zoom = 1.5)%>%
  addPolygons(fillColor = ~palchange2(change),
              weight = 1,
              opacity = 1,
              color = "white",
              dashArray = "3",
              fillOpacity = 0.7,
              highlight = highlightOptions(weight = 2,
                                           color = "#666",
                                           dashArray = "",
                                           fillOpacity = 0.7,
                                            bringToFront = TRUE),
              label = sprintf("<strong>%s</strong><br/>%g units",
                              world_leaflet_DALY$country, world_leaflet_DALY$change)%>% 
                lapply(htmltools::HTML),
              labelOptions = labelOptions(style = list("font-weight" = "normal",
                                                       padding = "3px 8px"),
                                          textsize = "12px",
                                          direction = "auto"),
              popup = paste0("Country: ", world_leaflet_DALY$country, "<br>",
                             "DALY Score: ",
                             round(world_leaflet_DALY$change, 3), 
                             " per 1K <br>")) %>%
   addLegend(pal = palchange2, values = ~change, 
            opacity = 0.7, 
             title = "Change in DALY scores",
             position = "bottomright")
```

```{r, echo = FALSE}
DALY_1990_leaflet
DALY_2017_leaflet
```

However, a similar concern arises as before: though we are effectively showing the distribution of DALY around the world for each year, the change is not necessarily clear at first sight due to a relatively small range of values. Therefore, similar steps were taken to show the change in DALY from 1990 to 2017. Note that the change was calculated by subtracting the value in 2017 from the value in 1990 (i.e. change = DALY_1990 - DALY_2017). Therefore, a positive value on this map indicates a decrease in DALY, while a negative value indicates an increase in DALY. For example, Spain has undergone a positive change (decrease) in DALY. Consistent with the two maps created above, we see that in general the countries experience a decrease in DALY.  

```{r, echo = FALSE}
DALY_change_leaflet
```

Now, taking a few steps back to the original question we are trying to answer, notice that the two maps showing the change in PM2.5 and DALY look quite similar at a first glance. There are countries that show an opposing trend, where there is an increase in PM2.5 exposure and a decrease in DALY, and vice versa. This might be accounted by other factors that might not have been reflected in this study, such as noticeable improvements in medical technology that might have contributed to a decrease in DALY despite the worsened air quality. However, for the most part, the countries that have a positive change in PM2.5 also experience a positive change in DALY, so we can reasonably conclude that PM2.5, an environmental factor, is evident in and consistent with DALY, a mortality measure.

## The relationship between PM2.5 and DALY through a scatterplot

The choropleths have sufficiently answered the question we wished to answer. However, a curious data scientist (like ourselves) might want to see more, perhaps what might be going on in between the two given years of 1990 and 2018, and whether the relationship between PM2.5 and DALY we have established earlier still holds true, if we were to take a look at a different time frame.

The most intuitive way to achieve this is probably to create plots that show the relationship between PM2.5 and DALY for a particular set of years, and without a Shiny app, we are almost certainly destined to make a multiple set of data visualizations, which can be exciting but also tedious and inefficient. In fact, this should be a supplementary resource, not a source of confusion or incompetence. Therefore, our solution to this is to retain the original vision to create a plot looking at how DALY changes with PM2.5, but produce these plots in a single gif file to show an animation of the change.   

In the following plot, each colored dot represents each individual country available in our data. As we proceed from 1990 to 2017, we see that the points in general move towards the bottom-left corner from the top-right corner of the plot. A noticeable exception to this happens from 2014 to 2015 (try to observe this yourself!) where many data points move towards the right side of the plot, indicating that from 2014 to 2015 there was a relatively significant increase in PM2.5 exposure in many countries around the world. This may be something that might be worthwhile to take some time to research on; this analysis indeed revealed something that we would not have been able to see if we stopped our analysis after the first part. 

```{r, message = FALSE, warning = FALSE, include = FALSE}
#is there a way to look at how both variables change in relation to one another over time,
#in a more broader term and in a single visualization?

g <- ggplot(data_joined, aes(PM25exposure , DALY, color = country))+
  geom_point(alpha = 0.7, show.legend = FALSE)+
  scale_size(range = c(2, 12))+
  theme_classic()+
  theme(
        rect = element_rect(fill = "transparent")
      )+
  labs(title = 'Year: {round(frame_time, 0)}', x = 'PM 2.5', y = 'DALY per 1K')+
  transition_time(year)+
  ease_aes('linear')
```

```{r, echo = FALSE, message = FALSE}
animate(g, duration = 20, fps = 20, width = 400, height = 400, renderer = gifski_renderer())
#anim_save("PM2.5 vs. DALY.gif")
```

## What actually happened in between the years 1990 and 2017? 

Now, with those in mind, an even more curious data scientist might want to see how either PM2.5 and DALY change for a particular country over a period of time that is not established through the choropleths. That is, a line graph or a similar sort where the x axis represents the year and the y axis represents either PM2.5 or DALY. This would be something that would be achieved most effectively and efficiently through shiny app’s interactivity: there are approximately 200 countries in the world (and in this data) and to display all of these countries at once would be unconventional. However, instead of making an extensive shiny app, we created a sample set of two line graphs that each show PM2.5 and DALY change over the years for a set of 10 randomly selected countries. We had done this because we did not want to put an equal or greater amount of coding efforts to something that is not the main tool to be used to achieve the original purpose, but still leave room for further investigation. 

The following two interactive line graphs show the change in DM2.5 and DALY from 1990 to 2017. This is similar to the earlier change leaflets we had displayed but different in that these show all the values for a country in a given year and that these don’t account for the rest of approximately 190 countries. Therefore, we will not make a particular analysis on these visualizations, as our analysis will not account for the entirety of the data. Please consider these as simply a supplemental resource to make a similar analysis we made in order to answer our original question with an additional capability to observe the variables in a given year between 1990 and 2017.

```{r, message = FALSE, warning = FALSE, include = FALSE}
#generate a list of randomly selected 10 countries
countrylist_index <- floor(runif(10, min = 0, max = nrow(data_joined)))
countrylist <- rep(c("country"), 10)

for (i in 1:length(countrylist_index)){
  countrylist[i] <- data_joined$country[countrylist_index[i]]
}

data_joined <- subset(data_joined, country %in% countrylist)

#plot DALY using the randomly chosen 10 countries
gdaly <- ggplotly(ggplot(data = data_joined, mapping = aes(x = year, y = DALY, color = country)) +
    geom_line() +
  scale_y_continuous(trans = "log10")+
    labs(
      title = "Disability-Adjusted Life (DALY) Year per 1K",
      subtitle = "1990 to 2017",
      y = "DALY",
      x = "Year")+
    theme_classic())

#plot PM2.5 exposure using the randomly chosen 10 countries
gexposure <- ggplotly(ggplot(data = data_joined, mapping = aes(x = year, y = PM25exposure, color = country)) +
     geom_line() +
     labs(
       title = "Population exposure to PM 2.5",
       subtitle = "1990 to 2017",
       y = "Population exposure ",
       x = "Year")+
    theme_classic())
```

```{r, echo = FALSE}
gexposure
gdaly
```

## Next Steps

As seen in our analysis using the choropleths, we had found that in general there seems to be a direct relationship between the change in air quality and mortality across countries. That is, an environmental factor can be evident in, and thus have directly impacted, the quality of life of the people. This being said, we wondered narrow down our focus to investigate whether an environmental factor could *disproportionately* affect countries around the world. Therefore, in the next section of this blog post, we will aim to answer the following question: "Are developing countries affected differently than developed countries by climate disasters?"

# Do climate change ripple effects (measured via infant and maternal mortality) vary from region-to-region? (MS)

When we think of climate change, and climate disasters, maternal and infant mortality are probably not the first phrases we associate with it. However, it turns out that there is a logical association between the two. This question was inspired by the Barbier, et. al. 2018 paper on *The Impacts of Climate Change on the Poor in Disadvantaged Regions*. The research paper described two categories for areas in developing countries: less-favored agricultural areas (LFAAs) and low-elevation coastal zones (LECZs). Not surprisingly, the LFAAs can be affected by changes to the terrain, soil, and overall precipitation, while LECZs, due to their coastal location, are more vulnerable to rises in the sea level, tropical storms, etc. Now we can see more clearly that climate disasters, such as flooding, storms, droughts, etc., could disproportionately affect rural areas in developing countries compared to developed countries. Changes in climate change, looked at here via climate disaster occurrence, pose threats to both the agricultural productivity and the resources of such developing communities. A secondary effect of such rural poverty is that on infant and maternal mortality rates.

Reference Used:
https://academic.oup.com/reep/article/12/1/26/4835833

## Infant and Maternal Mortality from 1980-2018

First, let's consider how the distribution of countries' infant and maternal mortality rates have changed over the years. Although more recent, even in the 1980s, we did not possess all the current medicine and technology we have today, especially medically related. The data on infant and maternal mortality that we used came from the OECD. Infant mortality was categorized by no minimum threshold of gestation period or birthweight, and recorded in terms of deaths per 1,000 live births. Maternal mortality was recorded in terms of deaths per 100,000 live births. From Figures 11 and 12 we can see that without looking at specific countries, there is a trend of decreasing infant and maternal mortality. In the 1980s, 23 countries were in our self-labeled "Developing" cluster (between standardized values of around -1 to 0), while in the 2010s, 
31 countries are in the "Developing" cluster (note the range has increased from -1 to 1). What's odd is that although we would expect a stark change in infant/maternal mortality values over time, we see more nuanced changes. The "Developing" cluster increases in size and range of values covered, while the "Middle" cluster is much more distinct and widespread than in the 1980s. We also still have one country (Mexico) that seemingly hasn't changed in terms of standardized values. It is likely that from 1980s to the 2010s, the mean infant and maternal mortality rates greatly improved, but the distirbution and distinction between various country groupings (such as "Developed", "Middle", and "Developing") has stayed fairly consistent. If infant mortality and maternal mortality all improved to the same standard, we would expect to see all countries in the "Developed" cluster. However, instead we see a larger "Developed" cluster, and blatant countries that have been left behind so to say, in terms of their infant and maternal mortality rates. All countries displayed reduction in infant/maternal mortality rates from the 1980s to 2010s. This can be better seen when looking at yearly values in the data set (use the link below to view the data used). However, from these clusters, we can draw our first conclusion, that not all countries have reached the same infant/maternal mortality rates. There is still a disparity in mortality rates for different countries.

One thing to note is that the data we used only had information on countries in North and South America, Australia, and parts of Europe. Many of the more predominant developing countries and agriculturally-based societies, such as in Africa and South/Southeast Asia did not have data recorded in the dataset.

Data Used:

Go to Health > Health Status > Maternal and infant mortality. Variables, years, and measures can be filtered out.

https://stats.oecd.org/Index.aspx?DatasetCode=HEALTH_STAT

```{r, warning = FALSE, message = FALSE, echo = FALSE}

## 1980s Cluster

#loading data
data_cluster1980s <- read_csv(paste0(my_path,"/wrangled_infmatmortcluster1980s.csv")) %>%
  mutate_at(c("avginfmort", "avmatmort"), funs(`std`=scale(.) %>% as.vector()))

#making cluster reproducible, setting number of clusters
set.seed(23)
km_out <- kmeans(data_cluster1980s[,c("avginfmort_std", "avmatmort_std")], centers = 3, nstart=20)

#vector of cluster assignments
#km_out$cluster

# add cluster assignment to the data frame
cluster1980s <- data_cluster1980s %>%
  mutate(clust = as.character(km_out$cluster))

# visualize the cluster assignments and centroids
ggplot(data = cluster1980s, aes(x = avginfmort_std, y = avmatmort_std)) + 
  geom_point(aes(color = clust)) +
  coord_fixed() +
  geom_point(data = as.data.frame(km_out$centers)
             , aes(x = avginfmort_std, y = avmatmort_std)
             , pch = "X"
             , size = 4) +
  theme_classic()+
  labs(x = "Standardized Average Infant Mortality"
       , y = "Standardized Average Maternal Mortality", title = "Infant and Maternal Mortality in the 1980s"
       , color = "Cluster Assignment")

```

```{r, warning = FALSE, echo = FALSE}

## 2010s Cluster

#loading data
data_cluster2010s <- read_csv(paste0(my_path, "/wrangled_infmatmortcluster2010s.csv")) %>%
  mutate_at(c("avginfmort", "avmatmort"), funs(`std`=scale(.) %>% as.vector()))

#making cluster reproducible, setting number of clusters
set.seed(23)
km_out <- kmeans(data_cluster2010s[,c("avginfmort_std", "avmatmort_std")], centers = 3, nstart=20)

#vector of cluster assignments
#km_out$cluster

# add cluster assignment to the data frame
cluster2010s <- data_cluster2010s %>%
  mutate(clust2 = as.character(km_out$cluster))

# visualize the cluster assignments and centroids
ggplot(data = cluster2010s, aes(x = avginfmort_std, y = avmatmort_std)) + 
  geom_point(aes(color = clust2)) +
  coord_fixed() +
  geom_point(data = as.data.frame(km_out$centers)
             , aes(x = avginfmort_std, y = avmatmort_std)
             , pch = "X"
             , size = 4) +
  theme_classic()+
  labs(x = "Standardized Average Infant Mortality"
       , y = "Standardized Average Maternal Mortality" 
       , title = "Infant and Maternal Mortality in the 2010s"
       , caption = "Figures 11 and 12. These figures shows standardized values for the infant and maternal mortality values of 36 countries and clusters them so as to minimize within-cluster variation. We can take the clusters on the higher end of both scales to be more developing countries, on the lower end to be developed, and in the middle to be somewhere across the spectrum of developedness. Each country appears as one point whose position represents its average infant/maternal mortality standardized value (over the decade)."
       , color = "Cluster Assignment")

```

## What does Yearly Change in Infant and Maternal Mortality Look Like?

<iframe height="650" width="100%" frameborder="no" title="Relationship BetweenInfant and Maternal Mortality and Natural Disaster Occurrence" src="https://mysubb.shinyapps.io/InfMatMortNatDisast/"> </iframe>


Let's zoom in to look how infant mortality changes yearly for a pair of countries. Consider Switzerland, the second most developed nation as of 2020, according to life expectancy, economic competitiveness, infrastructure, GDP per capita (*Developed Countries List 2020*). Switzerland's economy is based more in the service sector. Compare this to Mexico, which is less developed industrially, has more widespread poverty, and is a more agriculturally-based society. We know that Mexico would has worse infant and maternal mortality rates, compared to Switzerland (can be seen in original data tables). Specifically, Mexico started at 54.8 infant deaths per 1,000 live births in 1980 and decreased to 12.9 deaths per 1,000 live births in 2018. Switzerland started at 9.1 infant deaths per 1,000 live births in 1980 and decreased to 3.3 infant deaths per 1,000 live births in 2018. Thus, we can see that even in 1980, there was a great disparity in starting point and end point, however by 2018, the gap was greatly decreased. Now if we look at the yearly changes, we can understand how Mexico has much greater negative net changes in infant mortality. Note, I chose to focus the timeline on more recent years so that there is less impact from technological advancements in medicine. In fact, there is only one year (2017) where there is a positive net change in infant mortality. Switzerland on the other hand, while having negative net change in infant mortality between 2010 and 2018, has less frequent changes, and changes of lesser magnitude. In several years, the infant mortality rate stays the same. It also displays a positive net change in infant mortality in 2013. So it seems that in this case, the more agriculturally-based society has had a larger improvement in infant mortality rates than the classified Developed Country due to their largely varying starting points.

Now let's look at maternal mortality for those same two countries. We can note that the magnitude of net changes in maternal mortality are much less than that of infant mortality for both Mexico and Switzerland (compare the y-axis scale of -0.5 to 0.5 for infant mortality, and -5 to 5 for maternal mortality.) We should also note again that maternal mortality is measured in terms of 100,000 live births while infant mortality is measure din terms of 1,000 live births. We can see from the graphs that for Mexico, in most years, there is a decrease in maternal mortality (equal to or greater than the decreases experienced by Switzerland yearly). Switzerland, on the other hand, has a positive net change in maternal mortality in 4 out of the 8 years displayed, and these increases are greater than that experienced by Mexico. This might indicate that it is not random variation in maternal mortality, but there might be an added factor specific to Switzerland contributing to these increases between 2012 and 2017. This is contrary to our understanding of how developed Switzerland is in terms of life expectancy, access to health care, etc., but is a trend that was also noticed in infant mortality rates around 2011 (Wanner, et. al. 2017). From 2010 to 2017, Mexico's maternal mortality dropped from 43.7 to 35 deaths per 100,000 live births, while Switzerland's increased from 3.7 - 4.6 deaths per 100,000 live births. So what can we conclude from this? Surprisingly, the graphs of these two countries indicates that although Switzerland is more developed and thought to have better healthcare, their maternal mortality actually increased in the past decade, while Mexico's mainly decreased. So again we see a stronger magnitude of change towards better infant/maternal mortality stats in the devloping country vs. the developed. It is possible that there was more improvement of the health infrastructure in Mexico in the past decade that contributed to the larger rise vs. Switzerland, which already had on of the world's best health infrastructure (Rodríguez-Aguilar 2018). However, these results still make us question why a developed country is seeing such drastic increases in maternal mortality on a year to year basis.

If we look at another pair of developed countries, such as Estonia and Finland, we can see a similar variation between positive and negative net change in infant mortality over the past decade (albeit by different magnitudes). Finland varies much less in maternal mortality than Estonia does (in terms of magnitude of change), but they both display positive and negative changes. If we look at Germany (developed) and Hungary (in the developed/developing spectrum), we can see results similar to Switzerland and Mexico, where the more developed country bounces between positive and negative changes in mortality, while the less developed nation showcases more negative changes (of higher magnitude) in infant mortality. Maternal mortality, however, varies much more in Hungary (bounces between positive and negative changes, changes are of larger magnitude) than it does in Germany (changes of smaller magnitude, mostly negative changes in maternal mortality).


You can explore the trends in other countries' infant and maternal mortality stats over 2010-2018 by interacting with the graphic above. 

Zooming out though, from the countries we've looked at, are there any conclusions we can draw about infant and maternal mortality and how they relate to different countries (depending on whether they're developed or not)?

References Used:
https://bmcpregnancychildbirth.biomedcentral.com/articles/10.1186/s12884-017-1332-6
https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5862485/
*STILL NEED TO TYPE TEXT FOR:*

-two country comparison of maternal mortality
-two country comparison of natural disasters occurrence and mortality rates
-general trends/associations for infant mortality, maternal mortality, and natural disasters
-limitations/improvements/speculations

Data Used:

Natural Disaster Frequency Data by Country obtained from https://public.emdat.be/data

Note you must create an account and validate through email in order to view the datasets. Data is available from 1900-2020.

References Used:

https://worldpopulationreview.com/country-rankings/developed-countries
https://worldpopulationreview.com/country-rankings/developing-countries

## Is there an Association Between the Frequency of Climate Disasters and Infant/Maternal Mortality?

> We can hypothesize that countries facing higher frequencies, and more intense, natural disasters risk more damages to their agricultural and resources systems, which can reduce access to proper food, jobs, etc. that might ensure lower infant and maternal mortality rates.

# Impacts of Climate Disasters (LK)

Lastly, we decided to investigate how the impacts of climate/natural disasters have changed over time. Specifically, how has the number of people killed, injured, affected, and displaced due to these disasters changed?    

Certain natural disasters are more connected to environmental pollution and global warming more than others; for example, earthquakes are usually caused when the rock undergrounds suddenly break along the fault. The increase in global temperature or change in precipitation, therefore, is less likely to be directly relevant to earthquakes. On the other hand, floods and droughts are directly contingent on precipitation and the evapotranspiration of water to and from the atmosphere. Wildfires are more likely to occur when humidity is low. Landslides are more likely to occur when the deforestation is severe. 

Therefore, here we are examining 6 natural disasters: flood, storm, wildfire, drought, extreme temperature, and landslide. We obtained a dataset that recorded "*impactful*" natural disasters for the past 40 years. By "impactful" we mean that these disasters killed, injured, displaced, or affected humans in various ways:

- Death: a total number of people who lost their lives
- Injured: a total number of people who suffered from physical injuries, trauma, or an illness
- Homeless: a total number of people whose house was destroyed/damanged and therefore need shelter
- Affected: a total number of people who required medical attention or immediate assistance for basic survival needs (e.g. food, water, sanitation)

> We hypothesized that the frequency of impactful natural disasters would have increased since 1980. We also hypothesized that the consequences of these disasters would have intensified since 1980.

## Frequency of Natural Disasters

```{r, echo = FALSE, message = FALSE, warning = FALSE}

natdisfreq <- read_csv(paste0(my_path, "/wrangled_natdisasters_byyear.csv")) %>%
  filter(disaster_type != "All") %>%
  select(year, disaster_type, occurrence) %>%
  group_by(year, disaster_type) %>%
  summarize(total_occur = sum(occurrence))

```

First, we will test the hypothesis that the frequency of impactful natural disasters had increased over time. Take a look at a shiny app below.

- Compare the occurrences of different natural disasters. Are some natural disasters more common than others?
- What kind of general trend over time do you see?
- Select the disasters one by one. Did the frequency of some disasters increase more that the frequency of other disasters over time?

<iframe height="650" width="100%" frameborder="no" title="Frequency of Natural Disasters" src="https://lillianykim.shinyapps.io/naturaldisasterfreq/"> </iframe>


What do you see? First, we see that some natural disasters are more common than other disasters. Take the year 2011 as an example. There were `r natdisfreq[which(natdisfreq$year == 2011 & natdisfreq$disaster_type == "Wildfire"), 3]` landslides in 2011 worldwide, but there were `r natdisfreq[which(natdisfreq$year == 2011 & natdisfreq$disaster_type == "Storm"), 3]` floods. In year 2011, floods were `r round(natdisfreq[which(natdisfreq$year == 2011 & natdisfreq$disaster_type == "Storm"), 3] / natdisfreq[which(natdisfreq$year == 2011 & natdisfreq$disaster_type == "Wildfire"), 3], 0)` times more frequent than landslides, and this pattern holds generally true for other years as well. Floods and storms appear to be more frequent than droughts, extreme temperatures, landslides, and wildfires.  

Next, we can observe that the frequency of some disasters increased more than the frequency of other disasters. Examine the frequency of Droughts from 1980 to 2020. There is a great deal of fluctuation in the annual global frequency of droughts, but ultimately the peaks in the graphs stay relatively stable. In 1999, there were `r natdisfreq[which(natdisfreq$year == 1999 & natdisfreq$disaster_type == "Drought"), 3]` droughts, and so were in 2015. ( Keep in mind that we are only looking at the frequency per se, and not how it actually affected human societies. Save that thought for below) In contrast, examine the frequency of floods over time. We can see that floods became more and more frequent over time. There were only `r natdisfreq[which(natdisfreq$year == 1988 & natdisfreq$disaster_type == "Flood"), 3]` floods in 1988, but `r natdisfreq[which(natdisfreq$year == 2006 & natdisfreq$disaster_type == "Flood"), 3]` floods in 2006! In fact, the increasing trend is clearer for extreme temperatures, floods, and storms.

Most importantly, examining how the total occurrences of these 6 disasters, we can see that there is a general increasing trend. There is a noticeable increase in disaster frequency in 1990s, and it remains increased after 2000. We suspect that the increase may have been stalled after 2000 because countries became more equipped to handle natural disasters, suffered less damages from them. Such change would have rendered the disasters that were "impactful" in the past "impact*less*" (See the criteria in the shiny app above). Nevertheless, it is impossible to investigate **how** impactful these disasters were from this plot. For our second hypothesis, we turn to the interactive leaflet below.


## Impacts of Natural Disasters by Region

Take a look at the shiny app below. We created an interactive leaflet to allow the user to select a year between 1980 and 2020 and the type of disaster they are interested in. Each region is colored according to the total number of people killed, injured, displaced, or affected by the natural disasters of chosen types. 

- Start from 1980. Examine the choropleth every 4-5 years until you reach 2020. What kind of global trend do you see?
- Examine each of the disasters one by one. What trend, if any, do you see?

<iframe height="850" width="100%" frameborder="no" title="Impacts of Natural Disasters" src="https://lillianykim.shinyapps.io/naturaldisasters/"> </iframe>


As we examine the plot from the earlier years to the more recent years, we noticed that the choropleth became more and more colorful. This means that more people were killed, injured, displaced, or affected by the aforementioned natural disasters in recent years.

There are a few caveats that you should keep in mind:
This dataset does not record every single storm, drought, and flood that happened for the past few decades. Because it only records the natural disasters that affected humans beyond a certain extent, the trends shown here should be understood as a proxy, rather than a direct measurement of the frequency of natural disasters. For example, a storm may wreak havoc in developing countries that lack infrastructures to predict storms, prepare for the storms, and take necessary protective measures. However, an equally severe storm may barely affect some developed countries where houses and buildings are designed to withstand natural disasters, in which case the storm will not be recorded in this dataset. 


# Conclusion



# Works Cited
- Brown, Kaysie. “6 Global Issues to Watch in 2019.” Unfoundation.org, 23 Jan. 2020, unfoundation.org/blog/post/6-global-issues-to-watch-2019/. 
- “Global Emissions.” Center for Climate and Energy Solutions, 7 Jan. 2020, www.c2es.org/content/international-emissions/. 
- WHO (2018) Factsheet on ambient air quality and health. Available at http://www.who.int/news-room/fact-sheets/detail/ambient-(outdoor)-air-quality-and-health
- “Mortality, Morbidity, and Welfare Cost from Exposure to Environment-Related Risks.” Organization for Economic Co-Operation and Development (OECD), Jul. 2018. *file in repo*
