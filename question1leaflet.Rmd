---
title: "Untitled"
author: "Bella Han"
date: "11/4/2020"
output: html_document
---

```{r, message = FALSE}
#loading packages
library(tidyverse)
library(readr)
library(dplyr)
library(maps)
library(leaflet)
```

```{r, message = FALSE, warning = FALSE}
#use an appropriate path
path_bella <- "C:/Users/Bella/Desktop/git/Blog-HealthAndJusticeLeague/data"

#loading data
data_healthimp <- read_csv(paste0(path_bella,"/wrangled_HEimpacts.csv"))
data_air <- read_csv(paste0(path_bella, "/wrangled_PM25popexp.csv"))

#more wrangling smH
data_air <- data_air%>%
  rename(Y1990 = "1990")

#need to match the country name
data_air[16, 2] <- "South Korea"
data_air[24, 2] <- "Slovakia"
data_air[28, 2] <- "UK"
data_air[29, 2] <- "USA"
data_air[61, 2] <- "China"
data_air[64, 2] <- "Republic of Congo"
data_air[66, 2] <- "Ivory Coast"
data_air[69, 2] <- "North Korea"
data_air[103, 2] <- "Laos"
data_air[111, 2] <- "Macedonia"
data_air[162, 2] <- "Syria"
```

```{r, message = FALSE}
#leaflet for PM2.5
#world_leaflet$names
world_leaflet <- map("world", unique(data_air$Country), fill = TRUE, plot = FALSE)
world_leaflet$country <- vapply(strsplit(world_leaflet$names, ":"), function(x) x[1],
                                FUN.VALUE = "a")
world_leaflet$Y1990 <- data_air$Y1990[match(world_leaflet$country, data_air$Country)]

#index <- grep(":", world_leaflet$names)
# for (i in 1:length(index)){
#   for(j in 1:length(world_leaflet$names)){
#     if (index[i]==j)
#       world_leaflet$names[j] <- unlist(strsplit(world_leaflet$name[j], split=':', fixed=TRUE))[1]
#   }
# }

bins <- c(0, 10, 20, 30, 50, 70, 80, Inf)
pal <- colorBin("YlOrRd", domain = world_leaflet$Y1990, bins = bins)

labels <- sprintf(
  "<strong>%s</strong><br/>%g µg / m<sup>3</sup>",
  world_leaflet$country, world_leaflet$Y1990
) %>% lapply(htmltools::HTML)

PM25_1990_leaflet <- leaflet(data = world_leaflet)%>%
  addTiles()%>%
  setView(0, 0, zoom = 1)%>%
  addPolygons(fillColor = ~pal(Y1990),
              weight = 1,
              opacity = 1,
              color = "white",
              dashArray = "3",
              fillOpacity = 0.7,
              highlight = highlightOptions(weight = 5,
                                           color = "#666",
                                           dashArray = "",
                                           fillOpacity = 0.7,
                                            bringToFront = TRUE),
              label = sprintf("<strong>%s</strong><br/>%g µg / m<sup>3</sup>",
                              world_leaflet$country, world_leaflet$Y1990)%>% 
                lapply(htmltools::HTML),
              labelOptions = labelOptions(style = list("font-weight" = "normal", padding = "3px 8px"),
                                          textsize = "12px",
                                          direction = "auto"),
              popup = paste0("Country: ", world_leaflet$country, "<br>",
                             "PM2.5 Value: ", round(world_leaflet$Y1990, 3), 
                             " µg / m<sup>3</sup><br>"))%>%
  addLegend(pal = pal, values = ~Y1990, 
            opacity = 0.7, 
            title = "PM 2.5 Measure in 1990",
            position = "bottomright")
```

```{r}
#final leaftlet for PM 2.5 in 1990
PM25_1990_leaflet
```


